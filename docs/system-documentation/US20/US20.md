# US20 – Register an SNS user

## 1. Requirements Engineering

### 1.1. User Story Description

As a **Receptionist**, I want to register an SNS user so that the person can subsequently schedule a vaccination appointment.  The
user story belongs to sprint&nbsp;3 and has high priority.

### 1.2. Customer Specifications and Clarifications

### 1.3. Acceptance Criteria

The following acceptance criteria were established for US20:

1. **AC20‑1 – Format compliance:** the phone number and citizen card number must comply with the Portuguese format.
2. **AC20‑2 – Optional sex:** all fields are required except for the sex attribute.
3. **AC20‑3 – Uniqueness:** the phone number, e‑mail address, citizen card number and SNS user number must be unique across all registered users.

### 1.4. Found out Dependencies

Registering an SNS user is a pre‑requisite for the vaccine scheduling functionality (US30).  The current user story does not
depend on other features but relies on the existence of a service/repository infrastructure to store and query SNS users.  In
this sprint only an **in‑memory repository** is implemented; alternative persistence mechanisms can be plugged in through the
abstract factory introduced for repositories.

### 1.5. Input and Output Data

**Input data:**

- **Typed data:** name, date&nbsp;of&nbsp;birth, sex, postal address, phone number, e‑mail address, citizen card number,
  SNS user number.
- **Selected data:** none.

**Output data:**

- A success or error message confirming whether the SNS user was registered.  In case of an error the message explains
  whether it concerns missing fields, format violations or duplicate data.

### 1.6. System Sequence Diagram (SSD)

![US20‑SSD](svg/US20-SSD.svg)

### 1.7. Other Relevant Remarks

- Only receptionists are allowed to execute this use case.  Administrators register vaccination centres and personnel, whereas
  SNS users schedule appointments in a different user story.
- The system uses an **abstract factory** to obtain repositories.  In this sprint the **MemoryRepositoryFactory** returns
  an in‑memory implementation of the **SNSUserRepository**, but the architecture allows alternative persistence mechanisms to
  be introduced seamlessly.
- All validation and uniqueness checks are performed in the **SNSUserService**.  The repository merely persists data,
  following the separation of concerns recommended for the Service and Repository patterns.

---

## 2. OO Analysis

### 2.1. Relevant Domain Model Excerpt

![US20‑MD](svg/US20-MD.svg)

### 2.2. Other Remarks

- The receptionist in the domain model is a specialization of **Employee** (see sprint&nbsp;2 domain model).  For brevity
  only the role necessary to understand this use case is shown.
- The SNS user number uniquely identifies a patient within the National Health Service and is not reused for other purposes.

---

## 3. Design – User Story Realization

### 3.1. Rationale

| **Interaction ID** | **Question – Which class is responsible for…** | **Answer**            | **Justification / Pattern**                                                                              |
| ------------------ |------------------------------------------------| --------------------- | -------------------------------------------------------------------------------------------------------- |
| **Step 1**         | ...selects register SNS user?                  | `MainView`            | **Controller**: The main menu is a central controller for user interactions.                             |
| **Step 2**         | ...requests data (name)?                       | `RegisterSNSUserView` | **Information Expert (IE)**: The view is responsible for requesting and displaying the user data fields. |
| **Step 3**         | ...types requested data (name)?                | `Receptionist`        | **Creator**: The receptionist provides the required data.                                                |
| **Step 4**         | ...requests data (date of birth)?                 | `RegisterSNSUserView` | **IE**: The view asks for the user’s date of birth.                                                      |
| **Step 5**         | ...types requested data (date of birth)?          | `Receptionist`        | **Creator**: The receptionist enters the data.                                                           |
| **Step 6**         | ...requests data (sex)?                           | `RegisterSNSUserView` | **IE**: The view asks for the user's sex (optional).                                                     |
| **Step 7**         | ...types requested data (sex)?                    | `Receptionist`        | **Creator**: The receptionist provides the data.                                                         |
| **Step 8**         | ...requests data (postal address)?                | `RegisterSNSUserView` | **IE**: The view asks for the postal address.                                                            |
| **Step 9**         | ...types requested data (postal address)?         | `Receptionist`        | **Creator**: The receptionist enters the postal address.                                                 |
| **Step 10**        | ...requests data (phone number)?                  | `RegisterSNSUserView` | **IE**: The view asks for the user’s phone number.                                                       |
| **Step 11**        | ...types requested data (phone number)?           | `Receptionist`        | **Creator**: The receptionist provides the phone number.                                                 |
| **Step 12**        | ...requests data (email)?                         | `RegisterSNSUserView` | **IE**: The view asks for the user’s email address.                                                      |
| **Step 13**        | ...types requested data (email)?                  | `Receptionist`        | **Creator**: The receptionist provides the email address.                                                |
| **Step 14**        | ...requests data (citizen card number)?           | `RegisterSNSUserView` | **IE**: The view asks for the citizen card number.                                                       |
| **Step 15**        | ...types requested data (citizen card number)?    | `Receptionist`        | **Creator**: The receptionist provides the citizen card number.                                          |
| **Step 16**        | ...requests data (SNS user number)?               | `RegisterSNSUserView` | **IE**: The view asks for the SNS user number.                                                           |
| **Step 17**        | ...types requested data (SNS user number)?        | `Receptionist`        | **Creator**: The receptionist provides the SNS user number.                                              |
| **Step 18**        | ...shows all data and requests confirmation?      | `RegisterSNSUserView` | **IE**: The view displays all data to the receptionist for confirmation.                                 |
| **Step 19**        | ...confirms registration?                         | `Receptionist`        | **Creator**: The receptionist confirms the data.                                                         |
| **Step 20**        | ...informs operation success?                     | `RegisterSNSUserView` | **IE**: The view informs the receptionist that the registration was successful.                          |

**Systematization**

From the rationale the following conceptual classes are promoted to software classes:

- `SNSUser`
- `SNSUserService`
- `SNSUserRepository` (interface)
- `RepositoryFactory` (interface)
- `MemoryRepositoryFactory` (concrete factory)
- `SNSUserMemoryRepository` (concrete repository)
- `RegisterSNSUserController`
- `RegisterSNSUserView`

Other software classes identified:

- `App` – exposes the repository factory and SNSUserService.
- `MainView` – integrates the new menu option.

### 3.2. Sequence Diagram (SD)

![US20‑SD](svg/US20-SD.svg)

### 3.3. Class Diagram (CD)

![US20‑CD](svg/US20-CD.svg)

---

