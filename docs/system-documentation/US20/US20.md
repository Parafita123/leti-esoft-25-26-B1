# US20 – Register an SNS user

## 1. Requirements Engineering

### 1.1. User Story Description

As a **Receptionist**, I want to register an SNS user so that the person can subsequently schedule a vaccination appointment.  The
user story belongs to sprint&nbsp;3 and has high priority.

### 1.2. Customer Specifications and Clarifications

The project assignment explains that SNS users must be registered with a set of personal data.  According to the business
context, each SNS user record stores the person’s **name, date of birth, sex, postal address, phone number, e‑mail address,
citizen card number and SNS user number**.  These attributes comprise the minimal dataset that allows
subsequent appointment scheduling and certificate generation.

The sprint&nbsp;3 guide provides more detailed acceptance criteria.  It states that the **phone number and citizen card number
must comply with the Portuguese format**, the attribute **sex is optional** and all other fields are required.  Moreover,
the **phone number, e‑mail address, citizen card number and SNS user number must be unique across all registered SNS users**.

To interpret these requirements correctly, additional clarifications were gathered:

- **Phone number format:** the Portuguese numbering plan is closed and uses nine digits for every telephone number.  A valid
  phone number therefore contains exactly **nine digits** (the application does not handle international prefixes such as
  “+351”).
- **Citizen card number format:** a Portuguese citizen card number is composed of **eight digits**, an optional space or
  hyphen, **one digit**, an optional space, **two letters** and a final **check digit**.  The application
  must reject any number that does not match this pattern.
- **SNS user number:** the **Número de Utente** printed on the citizen card identifies a person in the National Health
  Service.  It is a **nine‑digit number** and is distinct from the social security number.

These clarifications guided the implementation of format validations and duplicate checks.

### 1.3. Acceptance Criteria

The following acceptance criteria were established for US20:

1. **AC20‑1 – Format compliance:** the phone number and citizen card number must comply with the Portuguese format.
2. **AC20‑2 – Optional sex:** all fields are required except for the sex attribute.
3. **AC20‑3 – Uniqueness:** the phone number, e‑mail address, citizen card number and SNS user number must be unique across all registered users.

### 1.4. Found out Dependencies

Registering an SNS user is a pre‑requisite for the vaccine scheduling functionality (US30).  The current user story does not
depend on other features but relies on the existence of an in‑memory repository to store and query SNS users.

### 1.5. Input and Output Data

**Input data:**

- **Typed data:** name, date&nbsp;of&nbsp;birth, sex (optional), postal address, phone number, e‑mail address, citizen card number,
  SNS user number.
- **Selected data:** none.

**Output data:**

- A success or error message confirming whether the SNS user was registered.  In case of an error the message must explain
  whether it concerns missing fields, format violations or duplicate data.

### 1.6. System Sequence Diagram (SSD)

The next diagram depicts the high‑level interaction between the receptionist and the system when registering a new SNS user.
Each interaction is numbered and the exchanged data is indicated.

![US20‑SSD](svg/US20-SSD.svg)

### 1.7. Other Relevant Remarks

- Only receptionists are allowed to execute this use case.  Administrators register vaccination centers and personnel, whereas
  SNS users schedule appointments in a different user story.
- The system currently uses in‑memory storage.  Nevertheless, the container responsible for SNS users was designed so that
  alternative persistence mechanisms can be introduced seamlessly in future sprints.
- The unique constraints (phone, e‑mail, citizen card number and SNS user number) were enforced within the domain layer to
  guarantee data integrity regardless of the user interface.

---

## 2. OO Analysis

### 2.1. Relevant Domain Model Excerpt

The domain model focuses on the actors and entities involved in this user story.  A **Receptionist** registers one or more
**SNS users**.  Each SNS user aggregates personal and identification data as described in the business context.  The sex
attribute is optional at this level.

![US20‑MD](svg/US20-MD.svg)

### 2.2. Other Remarks

- The receptionist in the domain model is a specialization of **Employee** (see sprint&nbsp;2 domain model).  For brevity
  only the role necessary to understand this use case is shown.
- The SNS user number uniquely identifies a patient within the National Health Service and is not reused for other purposes.

---

## 3. Design – User Story Realization

### 3.1. Rationale

| Interaction ID | Question – Which class is responsible for… | Answer | Justification / pattern |
|---|---|---|---|
| **Step 1** | presenting the option to register a new SNS user? | `MainView` | **Controller**: the main menu is a central controller of user interactions. |
| **Step 2** | requesting all the personal data from the receptionist? | `RegisterSNSUserView` | **Information Expert**: the view knows the fields that must be collected from the user. |
| **Step 3** | instantiating an SNS user with the provided data? | `RegisterSNSUserController` | **Controller**: coordinates between the view and the domain layer. |
| **Step 4** | creating the domain object that encapsulates the data? | `SNSUserContainer` | **Creator**: the container owns SNSUser objects and is therefore responsible for creating them. |
| **Step 5** | validating formats and checking uniqueness? | `SNSUserContainer` | **Information Expert**: it knows all registered users and the validation rules, thus it can enforce format and uniqueness constraints. |
| **Step 6** | asking for confirmation before persisting the new user? | `RegisterSNSUserView` | **Pure Fabrication / UI**: the view handles user interactions and confirmation. |
| **Step 7** | saving the SNS user and returning the result? | `RegisterSNSUserController` and `SNSUserContainer` | **Controller** delegates to the container, which persists the object and returns a result object. |
| **Step 8** | informing the receptionist about the outcome? | `RegisterSNSUserView` | **Information Expert**: the view communicates messages back to the actor. |

**Systematization**

From the rationale the following conceptual classes are promoted to software classes:

- `SNSUser`
- `SNSUserContainer`
- `RegisterSNSUserController`
- `RegisterSNSUserView`

Other software classes (pure fabrication) identified:

- `MainView` (existing) – to integrate the new menu option.
- `App` – exposes the SNS user container.

### 3.2. Sequence Diagram (SD)

The following UML sequence diagram shows the interactions between the actor (Receptionist) and the software objects that
collaborate to register a new SNS user.

![US20‑SD](svg/US20-SD.svg)

### 3.3. Class Diagram (CD)

This class diagram shows the static structure of the software elements introduced to implement US20.  The `App` class holds
the SNSUserContainer.  The controller mediates between the view and the domain layer.  The view handles all console
interactions.

![US20‑CD](svg/US20-CD.svg)

---

